<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Index of Computer System and Security</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="computer system, computer security" />
  
  
  
  
  <meta name="description" content="Diting0x@">
<meta property="og:type" content="website">
<meta property="og:title" content="Index of Computer System and Security">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Index of Computer System and Security">
<meta property="og:description" content="Diting0x@">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Index of Computer System and Security">
<meta name="twitter:description" content="Diting0x@">
  
    <link rel="alternate" href="/atom.xml" title="Index of Computer System and Security" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >
  <link rel="stylesheet" href="/css/hiero.css" >
  <link rel="stylesheet" href="/css/glyphs.css" >

</head>

<body>
  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            <a href="/" title="Index of Computer System and Security" rel="home">
              Index of Computer System and Security</a>
          </h1>
          <div class="site-description">Diting0x@</div>

            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">首页</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">关于</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/syssec">系统安全</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/architecture">系统结构</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/virtualization">虚拟化</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/malware">恶意代码</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/conferences">主流会议</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/courses">名人课堂</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/academy">学术专家</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/news">安全事件</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/knowledge">小科普</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/share">技术分享</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/contribution">本站达人</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>




  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main">
  
    <article id="post-tsx-exploit"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/20170504/tsx-exploit/">TSX处理器技术对漏洞利用意味着什么？</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/20170504/tsx-exploit/" class="article-date">
	  <time datetime="2017-05-04T10:29:25.000Z" itemprop="datePublished">五月 4, 2017</time>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Author：<a href="https://github.com/bzhu5" target="_blank" rel="external">Bing Zhu</a><br>Source：<a href="http://hypervsir.blogspot.com/2014/11/what-does-transactional-synchronization.html" target="_blank" rel="external">http://hypervsir.blogspot.com/2014/11/what-does-transactional-synchronization.html</a><br>转载请注明：原作者信息以及<a href="http://www.csyssec.org/about/" target="_blank" rel="external">CSysSec</a></p>
<hr>
<p><a href="http://en.wikipedia.org/wiki/Transactional_Synchronization_Extensions" target="_blank" rel="external">Intel Transactional Synchronization Extensions</a> (TSX) was introduced since from Haswell processor with adding hardware <a href="http://en.wikipedia.org/wiki/Transactional_memory" target="_blank" rel="external">transactional memory</a> support. It was originally design to speed up execution of multi-threaded software through lock elision. Every new technology has both good side and evil side, then how about TSX extension? What can we use it to do for vulnerability exploits and its defenses?</p>
<p><br><br>According to Intel SDM, TSX provides two software interfaces for programmers:</p>
<ul>
<li><strong>Hardware Lock Elision</strong> (HLE) is a legacy compatible instruction set extension (comprising the XACQUIRE and XRELEASE prefixes).</li>
<li><strong>Restricted Transactional Memory</strong> (RTM) is a new instruction set interface (comprising the XBEGIN, XABORT, and XEND instructions).</li>
</ul>
<p>This post is focusing on the RTM interface, as the specification indicates below.</p>
<ul>
<li><p><em>Software uses the XBEGIN instruction to specify the <strong>start of the transactional region</strong> and the XEND instruction to specify the <strong>end of the transactional region</strong>.</em></p>
</li>
<li><p><em>The XBEGIN instruction takes an operand that provides a relative offset to the <strong>fallback instruction address</strong> if the transactional region could not be successfully executed transactionally.</em></p>
</li>
<li><p><strong>*A processor may abort transactional execution for many reasons</strong>. The hardware automatically detects transactional abort conditions and restarts execution from the <strong>fallback instruction address</strong> with the architectural state corresponding to that at the start of the XBEGIN instruction and the EAX register updated to describe the abort status.*</p>
</li>
</ul>
<p><br><br>The interesting things here are as follows:</p>
<ol>
<li><strong>What reasons can cause a transactional execution abort?</strong></li>
<li><strong>What does it look like when a transactional execution abort happens?</strong></li>
</ol>
<p>For the 2nd question above, the TSX specification says below, </p>
<ul>
<li><em>The architecture ensures that updates performed within a transactional region that subsequently <strong>aborts execution will never become visible</strong>. Only a committed transactional execution updates architectural state. Transactional aborts never cause functional failures and only affect performance.</em></li>
</ul>
<p>which means <strong>after a TSX abort occurs, all the physical memory and processor register updates (after XBEGIN instruction) will be discarded</strong>, and from user’s perspective, the memory and register states are “restored” to the states at the start of XBEGIN instruction. This seems to be the same with the behaviors of try/catch or setjmp/longjmp functionalities. </p>
<p>However, there are some differences. For instance, any fault or trap in a transactional region that must be exposed to software will be suppressed, as if the fault or trap had never occurred. If any exception is not masked, that will result in a transactional abort and it will be as if the exception had never occurred. </p>
<p><strong>As matter of fact, all the synchronous exception events (like #GP, #PF) that occur during transactional execution are suppressed as if they had never occurred, and those events won’t be delivered to processor for handling.</strong> </p>
<p>Then regarding the 1st question above, there are a couple of reasons that might cause a TSX abort, like XABORT, CPUID, Software INT, VMX instructions, IO instructions, ring transitions (e.g. syscall), VMExit (ept violation), etc.</p>
<p>So, now let’s think about something about Intel TSX!</p>
<p>Provided that <strong><em>a malicious software attempts to access (e.g. write or execute) a protected memory, normally it will trigger a #PF fault, then it could be detected and terminated subsequently by OS kernel. But if the malicious software attempts to do the same thing in TSX state after an XBEGIN instruction, as we pointed out above, such a #PF exception will be suppressed, which means the OS kernel cannot even detect this access violation.</em></strong></p>
<p>The similar case also applies to the access to protected memory by EPT (extended page table) in a VMM/Hypervisor. Because when guest software attempts to access the physical memory protected with EPT in a hypervisor, an EPT violation vmexit will be triggered, but in TSX state, such a vmexit won’t be triggered, so the hypervisor won’t detect it. </p>
<p>So basically, <strong>it means that, To malicious software, before a successful attack, it can make more attempts (e.g. brute-forcing) to do bad things without being caught by OS kernel or even hypervisor.</strong> </p>
<p>But now I don’t have an idea on how to use it to do something “real bad”. Maybe someone else does have ideas…. </p>
<hr>
<p><strong><em>UPDATE:</em></strong><br>Interesting!!! got this….<br>TSX improves timing attacks against KASLR<br><a href="http://labs.bromium.com/2014/10/27/tsx-improves-timing-attacks-against-kaslr/" target="_blank" rel="external">http://labs.bromium.com/2014/10/27/tsx-improves-timing-attacks-against-kaslr/</a> </p>
<hr>
<p>转载请注明：原作者信息以及<a href="http://www.csyssec.org/about/" target="_blank" rel="external">CSysSec</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/硬件特性/">硬件特性<span class="article-category-count">9</span></a>


      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hardware/">Hardware</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TSX/">TSX</a></li></ul>

      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-lbr-idthooking"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/20170504/lbr-idthooking/">使用LRB(最近分支记录)特性检测IDT Hooking</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/20170504/lbr-idthooking/" class="article-date">
	  <time datetime="2017-05-04T10:27:43.000Z" itemprop="datePublished">五月 4, 2017</time>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Author：<a href="https://github.com/bzhu5" target="_blank" rel="external">Bing Zhu</a><br>Source：<a href="http://hypervsir.blogspot.com/2014/11/using-lbr-last-branch-record-feature-to.html" target="_blank" rel="external">http://hypervsir.blogspot.com/2014/11/using-lbr-last-branch-record-feature-to.html</a><br>转载请注明：原作者信息以及<a href="http://www.csyssec.org/about/" target="_blank" rel="external">CSysSec</a></p>
<hr>
<p>Thanks to <a href="https://twitter.com/ysmoo" target="_blank" rel="external">Yushi</a> who shared a presentation (<a href="http://www.iolanes.eu/_docs/eli_asplos12_slides.pdf" target="_blank" rel="external">ELI: Bare-Metal Performance for I/O Virtualization</a>) with me. In that hypervisor (ELI), it innovates an idea of gust IDT shadow (or IDT virtualization) design for some specific usage models. I’m going to talk a little bit about this idea.</p>
<p>This post firstly gives an introduction about IDT shadow in that paper, then talks about guest IDT hooking with this technique, and finally explains how to detect such a hooking with processor LBR feature. </p>
<h3 id="IDT-Shadow-Virtualization"><a href="#IDT-Shadow-Virtualization" class="headerlink" title="IDT Shadow/Virtualization"></a><strong>IDT Shadow/Virtualization</strong></h3><p>See picture below (captured from that presentation), it presents an idea of <em>Exitess Interrupt Delivery.</em></p>
<figure><br>    <a href="http://oij0laovn.bkt.clouddn.com/VIDT.png" target="_blank" rel="external"><img src="http://oij0laovn.bkt.clouddn.com/VIDT.png" width="450"></a><br>    <figcaption></figcaption><br></figure>

<p>The basic ideas are as follows:</p>
<ul>
<li><strong><em>Setup a guest shadow IDT table. With hardware virtualization’s help, we can easily to cheat guest OS software by monitoring and trapping guest execution of LIDT and SIDT instruction.</em></strong><br>We can maintain a shadow IDT table (and keep it sync’ed with the original one), then let the real guest logical processor IDTR.base point to our shadow IDT table.</li>
<li>And in shadow IDT table, it clears Present bit or reduces IDTR.limit to trap the wanted guest interrupts/exceptions.<br>The former idea is exactly the same with my idea in <a href="http://hypervsir.blogspot.com/2014/10/monitortrap-software-interrupt-int-08h.html" target="_blank" rel="external">previous post by generating #NP fault</a>. The later idea (triggering #GP) is not recommended in my opinion because decreasing DITR.limit will cause many false positives (please correct me if I am wrong). </li>
</ul>
<p>In that paper (see References at the end of this post for the link of this full paper), ELI utilizes the shadow IDT to implement a high-performance guest/host interrupt delivery solution without changes to guest OS kernel.</p>
<p>And one of other benefits is that the guest OS kernel integrity check (like Windows x64 OS<a href="http://en.wikipedia.org/wiki/Kernel_Patch_Protection" target="_blank" rel="external"> PatchGuard</a>) cannot even detect it.<br><br></p>
<h3 id="Guest-IDT-vector-entry-hooking"><a href="#Guest-IDT-vector-entry-hooking" class="headerlink" title="Guest IDT vector entry hooking"></a><strong>Guest IDT vector entry hooking</strong></h3><p>Another usage of shadow IDT is to <strong><em>hook any one of guest IDT ISRs by changing the corresponding ISR entry in the shadow IDT table</em></strong>. </p>
<p>For example, to implement an interrupt filter for a particular interrupt, we can change the IDT entry in the shadow IDT table and let it point to our own hooking ISR entry. After that, whenever that particular interrupt is triggered, the processor will firstly pass on the control to our hooking ISR routine, and we can do something (e.g. filtering), then jump to original OS kernel ISR for further handling. And under some circumstance, we can even let the control be back to our routine after original ISR handling (see the patent in the References).</p>
<p><strong><em>However, what if this kind guest IDT hooking is done by a malicious hypervisor? Then how to detect it in guest OS?</em></strong><br><br></p>
<h3 id="Detect-IDT-hooking-with-LBR-Last-Branch-Record"><a href="#Detect-IDT-hooking-with-LBR-Last-Branch-Record" class="headerlink" title="Detect IDT hooking with LBR (Last Branch Record)"></a><strong>Detect IDT hooking with LBR (Last Branch Record)</strong></h3><p>Nowadays, all the x86/Intel processors have a feature: Last Branch Record. </p>
<p>When it is enabled, the processor records a running trace of the most recent branches, <strong><em>interrupts, and/or exceptions</em></strong> taken by the processor in the last branch record (LBR) stack (could be in MSRs and/or Branch Trace Store (BTS) Buffer in DS save memory area). </p>
<p>To be specific, when this feature is configured by guest OS kernel, the processor will capture the trace (e.g. LastBranchToIP address) in LBR stack whenever an interrupt is generated by processor. So <strong><em>when the OS original ISR gets executed, it can check the content of LastBranchToIP in LBR stack, to see if it matches with the OS original ISR entry. If there is a mismatch, then it indicates that the corresponding ISR entry is hooked by others, e.g. by a malicious hypervisor.</em></strong> </p>
<p>But in a hypervisor environment, there are some solutions to prevent guest OS kernel from detecting IDT hooking with LBR feature, e.g.,</p>
<ul>
<li>Hide LBR and disabling this feature by trapping corresponding CPUID instruction (LBR capability check) and MSR read/write access to LBR control MSRs.</li>
<li>Because LBR stack could be stored with some LBR MSRs, hypervisor must trap those MSRs, and return faked values.</li>
<li>And hypervisor must also trap read access to Branch Trace Store (BTS) Buffer of DS-save memory area if guest OS configures the LBR stack to be also stored in BTS buffer. </li>
</ul>
<hr>
<p><strong><em>References:</em></strong></p>
<p>Ravi, et al.,Patent: Secure handling of interrupted events utilizing a virtual interrupt definition table (VIDT):<br><a href="http://patft.uspto.gov/netacgi/nph-Parser?Sect2=PTO1&amp;Sect2=HITOFF&amp;p=1&amp;u=/netahtml/PTO/search-bool.html&amp;r=1&amp;f=G&amp;l=50&amp;d=PALL&amp;RefSrch=yes&amp;Query=PN/8578080" target="_blank" rel="external">http://patft.uspto.gov/netacgi/nph-Parser?Sect2=PTO1&amp;Sect2=HITOFF&amp;p=1&amp;u=/netahtml/PTO/search-bool.html&amp;r=1&amp;f=G&amp;l=50&amp;d=PALL&amp;RefSrch=yes&amp;Query=PN/8578080</a></p>
<p>The full paper for ELI presentation from IBM israel research lab: Abel Gordon, et al. ELI: Bare-Metal Performance for I/O Virtualization<br><a href="http://www.mulix.org/pubs/eli/eli.pdf" target="_blank" rel="external">http://www.mulix.org/pubs/eli/eli.pdf</a></p>
<hr>
<p>转载请注明：原作者信息以及<a href="http://www.csyssec.org/about/" target="_blank" rel="external">CSysSec</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/硬件特性/">硬件特性<span class="article-category-count">9</span></a>


      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hardware/">Hardware</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hooking/">Hooking</a></li></ul>

      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-bitvisor"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/20170504/bitvisor/">BitVisor- 一种实施I/O设备安全的轻量级Hypervisor</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/20170504/bitvisor/" class="article-date">
	  <time datetime="2017-05-04T10:25:16.000Z" itemprop="datePublished">五月 4, 2017</time>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Author：<a href="https://github.com/bzhu5" target="_blank" rel="external">Bing Zhu</a><br>Source：<a href="http://hypervsir.blogspot.com/2014/11/paper-read-bitvisor-thin-hypervisor-for.html" target="_blank" rel="external">http://hypervsir.blogspot.com/2014/11/paper-read-bitvisor-thin-hypervisor-for.html</a><br>转载请注明：原作者信息以及<a href="http://www.csyssec.org/about/" target="_blank" rel="external">CSysSec</a></p>
<hr>
<p>This post is wrote to share an idea of the paper (<a href="http://dl.acm.org/citation.cfm?id=1508311" target="_blank" rel="external">BitVisor: A Thin Hypervisor for Enforcing I/O Device Security</a>) that I read recently. It innovates a <strong>hypervisor-based solution for enforcing storage/disk encryption of ATA devices</strong>.<br>As we know that Direct memory access (DMA) is a feature in computer system that allows certain hardware subsystems to directly access main system memory independently of the CPU/processor. </p>
<p>As shown in picture below (from <a href="http://en.wikipedia.org/wiki/IOMMU" target="_blank" rel="external">wikipedia</a>), processor MMU (if present) cannot directly intercept data movement between external DMA-capable devices and the main memory. Even in a virtualization environment, extended page table (EPT or NPT) MMU configured by Hypervisor cannot protect the main memory resource, this is one of reasons of why the technology IOMMU like VT-d (<a href="https://software.intel.com/en-us/articles/intel-virtualization-technology-for-directed-io-vt-d-enhancing-intel-platforms-for-efficient-virtualization-of-io-devices" target="_blank" rel="external">Intel Virtualization Technology for Directed I/O</a>) is introduced to prevent malicious device drivers from attacking against the main memory even hypervisor owned memory space. </p>
<figure><br>    <a href="http://oij0laovn.bkt.clouddn.com/MMU_and_IOMMU.png" target="_blank" rel="external"><img src="http://oij0laovn.bkt.clouddn.com/MMU_and_IOMMU.png" width="450"></a><br>    <figcaption></figcaption><br></figure>

<p><strong>Although the processor has no chance to intercept the data transferred between device and main memory, it still has chances to intercept the access to DMA control data regions like DMA descriptors that store transferring information,<br>such as the buffer address and the size of the data.</strong></p>
<p>Because basically all the DMA host controllers are using some specific command control registers to configure and trigger DMA data transfers. Those registers are commonly represented as I/O based or/and MMIO based registers, the former registers are accessed with I/O port (e.g. IN/OUT or INTS/OUTS instructions in x86 system), and the latter registers are accessed with <a href="http://en.wikipedia.org/wiki/Memory-mapped_I/O" target="_blank" rel="external">memory-mapped I/O</a> method with generic memory movement instructions (like MOV instruction).</p>
<p>In x86 virtualization, both accesses with I/O port and MMIO can be monitored by hypervisor (e.g. through I/O port bitmap VMCS configuration, and appropriate EPT page permission settings). </p>
<p>In BitVisor, <strong>a thin hypervisor intercepts any read/write access to the ATA DMA host controller’s command-block registers and control-block register. Therefore, it is easy to obtain information necessary to enforce encryption</strong>. For example, the hypervisor can obtain the LBA and sector count by intercepting writes to these registers. Similarly, the corresponding ATA disk DMA descriptor can also be monitored and controlled by BitVisor hypervisor. </p>
<p><strong>With intercepting all the information as mentioned above, the hypervisor has knowledge of where the DMA buffer (physical address) will be transferred to/from, when to start/stop data transfers, and what size in bytes will be transferred to/from external device.</strong></p>
<p>This paper presents a novel idea of <strong><em>shadow DMA descriptors</em></strong> (see Figure below, click it to enlarge) for safely intercepting the content of data transferred by DMA. A shadow DMA descriptor is a shadow of the DMA descriptor of the guest OS (guest DMA descriptor).The hypervisor sets the shadow DMA descriptors to the host controller (rather than the real guest DMA descriptor). The shadow DMA descriptor specifies a memory region controlled by the hypervisor as a temp buffer, called the shadow buffer. </p>
<p>When data movement starts, the DMA host controller transfers data between the shadow buffer (rather than the real guest buffer) and the device, based on the shadow DMA descriptors. After data movement is completed, the hypervisor emulates the host controller behaviors by copying data between the shadow buffer and the guest buffer that is specified in the real guest DMA descriptor.</p>
<figure><br>    <a href="http://oij0laovn.bkt.clouddn.com/BitVisor.png" target="_blank" rel="external"><img src="http://oij0laovn.bkt.clouddn.com/BitVisor.png" width="450"></a><br>    <figcaption></figcaption><br></figure>

<p>Now that hypervisor can fully control and intercept the DMA data content, the encryption and decryption become easy. When guest software writes the data to ATA disk, the hypervisor can enforce encryption from guest buffer to shadow buffer (that eventually goes to disk), and in reverse order when guest software reads data from ATA disk, the hypervisor will decrypt data from shadow buffer (coming from disk) to guest buffer. </p>
<p>On the other side, as a pretty good side effort, <strong><em>we can utilize this solution to enforce protection from device-specific DMA attacks on a platform that is lack of IOMMU (e.g. VT-d) capability</em></strong>. For instance, the hypervisor can verify the address of guest buffers specified in the guest DMA descriptors so that the address (plus the data size) does not point to the hypervisor memory regions and any other protected guest memory regions.  </p>
<p>As we can see that the hypervisor can capture the event when DMA starts. However, the end of DMA transfer is usually notified by a hardware interrupt, but BitVisor cannot identify the ATA device that issues hardware interrupts. Instead, BitVisor captures I/O access to status registers, because device drivers usually read status registers to check whether DMA transfer has finished successfully or not, and write registers to acknowledge interrupts. <strong><em>As an alternative, the solution in <a href="http://hypervsir.blogspot.com/2014/10/monitortrap-software-interrupt-int-08h.html" target="_blank" rel="external">my previous post</a> can solve this issue by monitoring the ATA disk external interrupt.</em></strong></p>
<p>To download the source code of latest BitVisor, please go to the official site <a href="http://www.bitvisor.org/" target="_blank" rel="external">http://www.bitvisor.org/</a></p>
<p>See below <a href="https://www.bitvisor.org/summit/slides/BitVisor-Summit-04-matsubara.pdf" target="_blank" rel="external">snapshot</a> (and other one <a href="http://www.slideshare.net/shinagawa/20121204-bitvisor-summit" target="_blank" rel="external">BitVisor Summit @2012</a>), it uses the Ring3 layer in VMX-root to hold various services. </p>
<figure><br>    <a href="http://oij0laovn.bkt.clouddn.com/BitVisor-layer.png" target="_blank" rel="external"><img src="http://oij0laovn.bkt.clouddn.com/BitVisor-layer.png" width="450"></a><br>    <figcaption></figcaption><br></figure>


<hr>
<p><strong><em>References:</em></strong><br>TreVisor:<br>OS-Independent Software-Based Full Disk Encryption &amp; Secure Against Main Memory Attacks<br><a href="http://www1.cs.fau.de/filepool/projects/trevisor/trevisor.pdf" target="_blank" rel="external">http://www1.cs.fau.de/filepool/projects/trevisor/trevisor.pdf</a></p>
<p>OSb: OSv on BitVisor<br><a href="http://www.slideshare.net/yushiomote/osb-osv-on-bitvisor" target="_blank" rel="external">http://www.slideshare.net/yushiomote/osb-osv-on-bitvisor</a></p>
<p>Takahiro Shinagawa: Introduction to the BitVisor and Comparison with Xen<br><a href="http://www.slideshare.net/xen_com_mgr/xs-japan-2008-bitvisor-english" target="_blank" rel="external">http://www.slideshare.net/xen_com_mgr/xs-japan-2008-bitvisor-english</a></p>
<p>Dependable Cloud Computing<br><a href="http://www.slideshare.net/kazuhikokato/121127-37898979" target="_blank" rel="external">http://www.slideshare.net/kazuhikokato/121127-37898979</a></p>
<p>Kernel Memory Protection by an Insertable Hypervisor which has VM Introspection and Stealth Breakpoints (IWSEC2014)<br><a href="http://www.slideshare.net/suzaki/international-workshop-on-security-iwsec2014" target="_blank" rel="external">http://www.slideshare.net/suzaki/international-workshop-on-security-iwsec2014</a></p>
<p>A Hypervisor IPS based on Hardware Assisted Virtualization Technology<br><a href="http://www.slideshare.net/ffri/bh-usa08murakami" target="_blank" rel="external">http://www.slideshare.net/ffri/bh-usa08murakami</a></p>
<hr>
<p>转载请注明：原作者信息以及<a href="http://www.csyssec.org/about/" target="_blank" rel="external">CSysSec</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/Hypervisor安全/">Hypervisor安全<span class="article-category-count">1</span></a>


      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Virtualization/">Virtualization</a></li></ul>

      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-xencolor"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/20170504/xencolor/">Xen模式-你的XEN是什么颜色？</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/20170504/xencolor/" class="article-date">
	  <time datetime="2017-05-04T10:23:26.000Z" itemprop="datePublished">五月 4, 2017</time>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Author:<a href="http://www.brendangregg.com/index.html" target="_blank" rel="external">Brendan D. Gregg</a><br>Source:<a href="http://www.brendangregg.com/blog/2014-05-07/what-color-is-your-xen.html" target="_blank" rel="external">http://www.brendangregg.com/blog/2014-05-07/what-color-is-your-xen.html</a><br>转载请注明：原作者信息以及<a href="http://www.csyssec.org/about/" target="_blank" rel="external">CSysSec</a></p>
<hr>
<p>What’s faster: <strong>PV</strong>, <strong>HVM</strong>, <strong>HVM with PV drivers</strong>, <strong>PVHVM</strong>, or <strong>PVH</strong>? Cloud computing providers using <a href="http://www.xenproject.org/" target="_blank" rel="external">Xen</a> can offer different virtualization “modes”, based on paravirtualization (PV), hardware virtual machine (HVM), or a hybrid of them. As a customer, you may be required to choose one of these. So, which one?</p>
<p>Rackspace offers <a href="http://www.rackspace.com/knowledge_center/article/choosing-a-virtualization-mode-pv-versus-pvhvm" target="_blank" rel="external">PV or PVHVM</a>, and Amazon EC2 offers <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-types.html" target="_blank" rel="external">PV or HVM</a>. I’d summarize the choice today as:</p>
<pre><code>The best performance is the latest PV/HVM hybrid mode that Xen supports.
</code></pre><p>For most places right now, PVHVM should deliver the best performance. On AWS EC2, if you create a “HVM” instance, and Linux supports it, you get PVHVM. In the future (Xen 4.4+) the fastest mode will be <a href="http://blog.xen.org/index.php/2014/01/31/linux-3-14-and-pvh/" target="_blank" rel="external">PVH</a>.</p>
<p>Not picking the latest hybrid mode should only make sense for some corner cases. You can test this yourself, as your mileage and requirements may vary.</p>
<p>Now, if you search for <a href="http://lmgtfy.com/?q=PV+vs+HVM" target="_blank" rel="external">PV vs HVM</a>, the more you read the more confused you may become. My first hit was a post from 2012 discussing EC2 choices, concluding with:</p>
<pre><code>&quot;If you want a good performance for Linux/Unix then use PV&quot;
</code></pre><p>You might still be thinking the same, and a while ago this was right, before many changes in the world of Xen (before PV drivers on HVM, PVHVM, and PVH). At least the post from 2012 has a date on it (like this one).</p>
<p>What makes this even more confusing is that never versions of the hybrid model have been named as separate “modes”. In this post, I’ll summarize the current virtualization spectrum model, and suggest a slightly different explanation: instead of focusing on the choice of modes, I’ll show them as an evolution of versions.</p>
<p>Note that I’m not a Xen developer, so I’m not an official source of Truth for this: I’m a performance architect for a large EC2 user, and I’m hoping to contribute to our collective understanding of Xen choices.<br><br></p>
<h3 id="The-Virtualization-Spectrum"><a href="#The-Virtualization-Spectrum" class="headerlink" title="The Virtualization Spectrum"></a><strong>The Virtualization Spectrum</strong></h3><p>In the articles <a href="http://blog.xen.org/index.php/2012/10/23/the-paravirtualization-spectrum-part-1-the-ends-of-the-spectrum/" target="_blank" rel="external">The Ends of the Spectrum</a> and <a href="http://blog.xen.org/index.php/2012/10/31/the-paravirtualization-spectrum-part-2-from-poles-to-a-spectrum/" target="_blank" rel="external">From Poles to a Spectrum</a>, George Dunlap introduced the idea that there are no longer two modes of Xen virtualization – PV or HVM – but, rather, a spectrum of modes, where PV and HVM are the poles.</p>
<figure><br>    <a href="http://oij0laovn.bkt.clouddn.com/xen-virt-spectrum-crop-800.png" target="_blank" rel="external"><img src="http://oij0laovn.bkt.clouddn.com/xen-virt-spectrum-crop-800.png" width="450"></a><br>    <figcaption></figcaption><br></figure>

<p>This is pictured in the right diagram <a href="http://www.slideshare.net/xen_com_mgr/linuxcon-eu-virtualization-in-the-cloud-featuring-xen-and-xcp/16" target="_blank" rel="external">from Lars Kurth</a>, which lists different Xen virtualization modes as rows, and features as columns. Full HVM mode is the top row, full PV mode is the bottom, and hybrid modes are in-between. (This shows PVH as a Xen 4.3 feature; it’s now Xen 4.4.)</p>
<p>The HVM and PV technologies provide their own performance benefits:</p>
<ul>
<li><strong>HVM</strong>: A processor technology for accelerating CPU virtualization (privileged instructions, syscalls) and the MMU (page tables). This is supported by Intel (VT-x) and AMD (AMD-V).</li>
<li><strong>PV</strong>: A software technology where the guest kernel can use an accelerated interface for virtualized components, including disks and network interfaces, rather than emulating hardware.<br>Xen has been developing additional hybrid modes for the best of both words, where a HVM guest can use faster PV kernel parts, or vice versa. At first, PV disk and network drivers on HVM were possible. Then, interrupts and timers. Each of these moves reduced the need for slower emulation, such as via QEMU, improving performance. This is all summarized pretty well by the spectrum diagram.</li>
</ul>
<p>You can find more detailed explanations of the modes in those <a href="http://blog.xen.org/index.php/2012/10/23/the-paravirtualization-spectrum-part-1-the-ends-of-the-spectrum/" target="_blank" rel="external">two</a> <a href="http://blog.xen.org/index.php/2012/10/31/the-paravirtualization-spectrum-part-2-from-poles-to-a-spectrum/" target="_blank" rel="external">articles</a>. As George suggested, PVH is expected to be the best hybrid mode, and that other modes could eventually be dropped from the Linux kernel, simplifying it. And, if HVM existed (the Intel VT-x or AMD-V processor features) when Xen was written, PVH would probably have been the chosen mode.<br><br></p>
<h3 id="The-Colors-of-Xen"><a href="#The-Colors-of-Xen" class="headerlink" title="The Colors of Xen"></a><strong>The Colors of Xen</strong></h3><p>So Xen today is something of a mess – the result of evolving software and hardware features, aiming to provide the best performance possible. And, as George noted in his first article, the terminology has been a little unclear, and has evolved over time.</p>
<p>The spectrum of modes is great way to make sense of this, but there are some loose ends. One is that a spectrum of modes can imply a choice when doesn’t need to be one: if my instance supports PVHVM, should I study its pros and cons versus PV drivers over HVM? No, PVHVM is just the latest version of the same thing. So, instead of a spectrum of modes, is it more a spectrum of versions?</p>
<p>There are other sources of confusion: George’s <a href="http://blog.xen.org/index.php/2012/10/31/the-paravirtualization-spectrum-part-2-from-poles-to-a-spectrum/" target="_blank" rel="external">article</a> describes “PVHVM mode” and “PVH mode”, then depicts them inside “HVM mode” and “PV mode” groups, which are labeled as “mode/domain” in the above figure. So “PVHVM mode” is a mode, but “PV mode” is a domain or group of modes?</p>
<p>His article also warns about PVHVM mode confusion:</p>
<blockquote>
<p>(“PVHVM” mode should not be confused with “PV-on-HVM” mode, which is a term sometimes used in the past for “fully virtualized with PV drivers”.)<br>I understand this statement, however, many sources seem to still misuse the terms: the Xen wiki page on PV on HVM describes this as “also called PVHVM or <a href="http://wiki.xen.org/wiki/PV_on_HVM" target="_blank" rel="external">PV-on-HVM</a> drivers”, which seems to contradict the warning. Also, what I think are the developer’s slides on PVHVM are actually titled “<a href="http://www.slideshare.net/xen_com_mgr/6-stefano-spvhvm" target="_blank" rel="external">Linux PV on HVM</a>. Maybe I’m wrong and these are consistent, but I struggle to see how.<br><br></p>
</blockquote>
<h3 id="Back-to-Poles"><a href="#Back-to-Poles" class="headerlink" title="Back to Poles"></a><strong>Back to Poles</strong></h3><p>Here’s a different way to think about the modes, if it helps. Lets go back to the poles model (PV and HVM), before the spectrum, and explain the current state of Xen in that context.</p>
<p>In this model, there are only two modes to worry about, PV and HVM, and each mode may support additional features to improve performance:</p>
<ul>
<li><strong>PV</strong>: Use this if the PVH feature is supported, which boots the best type of hybrid. You may also need to choose this if the processor doesn’t do HVM: eg, following the EC2 <em><a href="http://aws.amazon.com/amazon-linux-ami/instance-type-matrix/" target="_blank" rel="external">instance type matrix</a></em> , where you will end up with a fully PV mode instance.</li>
<li><strong>HVM</strong>: Until PVH, choose this. Xen, and the guest kernel, are likely to support a number of enhancements which use PV code paths, so the booted instance will be a hybrid. The number of enhancements depends on the Xen and guest kernel versions: newer for more.</li>
</ul>
<p>This selection of instances is pictured in the flowchart on the right. It shows what can be selected to achieve the highest performance, in general. You may have a corner case that differs, due to different requirements.</p>
<figure><br>    <a href="http://oij0laovn.bkt.clouddn.com/xen-mode-flow.png" target="_blank" rel="external"><img src="http://oij0laovn.bkt.clouddn.com/xen-mode-flow.png" width="450"></a><br>    <figcaption></figcaption><br></figure>

<p>PVHVM and PVH can be thought of as features and not modes. The choices are PV or HVM, which describes how the instance boots, and your choice may be influenced by the features available. Currently, on EC2, PVH is not available, but PVHVM is: so the best choice for Linux (in general) would be booting a “HVM” instance with PVHVM enabled (eg, setting CONFIG_XEN_PVHVM).</p>
<p>I’ve redrawn the spectrum picture on the right to emphasize the two modes, and to group all mixed types as “Hybrid”, showing that they are a progression of Xen versions, rather than a group of modes to choose from. Is this helpful?</p>
<figure><br>    <a href="http://oij0laovn.bkt.clouddn.com/xen-colors.png" target="_blank" rel="external"><img src="http://oij0laovn.bkt.clouddn.com/xen-colors.png" width="450"></a><br>    <figcaption></figcaption><br></figure>

<p>If you don’t find this an improvement, I’ll try a different way to clarify what your Xen guest is doing in my next post, where I’ll cover tools for feature detection.<br><br></p>
<h3 id="Enhanced-Networking"><a href="#Enhanced-Networking" class="headerlink" title="Enhanced Networking"></a><strong>Enhanced Networking</strong></h3><p>While my spectrum diagram may be an improvement, I’ve left a loose end untied: <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/enhanced-networking.html" target="_blank" rel="external">SR-IOV for enhanced networking</a>. If the instance type supports it, this uses hardware virtualization enhancements to improve performance and provide an interface better suited for virtualization. In some ways, this is an evolution of I/O controllers that is similar to what processors have done, with their own virtualization extensions.</p>
<p>SR-IOV, if you can enable it, should provide the best I/O performance. So perhaps the first feature column in the spectrum diagram should really show two options: P (paravirt) as yellow, and VH (SR-IOV) as green. Here’s how it <a href="http://www.brendangregg.com/blog/images/2014/xen-colors-sriov.png" target="_blank" rel="external">looks</a> (although I’m not sure all the hybrid types support SR-IOV).<br><br></p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a><strong>Conclusion</strong></h3><p>Nowadays, there are various hybrid Xen modes (or versions), which obsolete older advice that “PV is fastest”. On AWS EC2 today, “HVM” mode (which supports PVHVM) should be fastest. In the future, it will be PVH. If you can, you can also enable SR-IOV to improve I/O performance further.</p>
<p>In this post I summarized the spectrum model of the modes, and described them a little differently in terms of the earlier PV or HVM model. The number of Xen modes is a little confusing, and is a result of an evolution of software and hardware, and Xen development work to deliver the fastest guests they can.</p>
<p>A while ago I wrote a post on <a href="http://dtrace.org/blogs/brendan/2013/01/11/virtualization-performance-zones-kvm-xen/" target="_blank" rel="external">the performance of Zones vs KVM vs Xen</a>, and for Xen I pictured a fully HVM instance with the QEMU I/O proxy, mentioning that paravirtualization drivers could improve I/O performance. That how I’d draw the digram today: as I/O should be using the faster PV drivers, even for <a href="http://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/Upgrading_PV_drivers.html" target="_blank" rel="external">Windows</a>.</p>
<p>Despite the Xen improvements, Solaris Zones, or Linux containers, should still be the fastest possible virtualization option, allowing guests to run bare-metal everything. But there is still a road ahead for their widespread adoption: a topic for another post.</p>
<p>In my <a href="http://www.brendangregg.com/blog/2014-05-09/xen-feature-detection.html" target="_blank" rel="external">next post</a>, I show various tools you can use from your Linux Xen guest to detect which HVM and PV features are enabled.<br><br></p>
<h3 id="References-and-Resources"><a href="#References-and-Resources" class="headerlink" title="References and Resources"></a><strong>References and Resources</strong></h3><ul>
<li>George Dunlap’s <a href="http://blog.xen.org/index.php/2012/10/23/the-paravirtualization-spectrum-part-1-the-ends-of-the-spectrum/" target="_blank" rel="external">The Ends of the Spectrum</a> and <a href="http://blog.xen.org/index.php/2012/10/31/the-paravirtualization-spectrum-part-2-from-poles-to-a-spectrum/" target="_blank" rel="external">From Poles to a Spectrum</a> are the best summary of all the modes, and how these have been developed (evolved) little by little.</li>
<li>Lars Kurth’s talk <a href="http://www.slideshare.net/xen_com_mgr/linuxcon-eu-virtualization-in-the-cloud-featuring-xen-and-xcp/16" target="_blank" rel="external">Virtualization in the Cloud Featuring Xen</a>.</li>
<li>Stefano Stabellini’s <a href="http://www.slideshare.net/xen_com_mgr/6-stefano-spvhvm" target="_blank" rel="external">Linux PV on HVM</a>, and especially the <a href="http://vimeo.com/33056481" target="_blank" rel="external">video</a>, give the best insight into why the PVHVM features were developed, and the value they bring.</li>
<li>The Xen <a href="http://wiki.xen.org/wiki/Xen_Linux_PV_on_HVM_drivers" target="_blank" rel="external">Linux PV on HVM drivers</a>shows more commands for studying Xen configuration.</li>
<li>Also see the Xen wiki <a href="http://wiki.xen.org/wiki/PV_on_HVM" target="_blank" rel="external">PV on HVM</a> page.</li>
<li><a href="http://blog.xen.org/index.php/2014/01/31/linux-3-14-and-pvh/" target="_blank" rel="external">Linux 3.14 and PVH</a>, describing how to get the development version working.</li>
<li>See the <a href="http://www.slideshare.net/xen_com_mgr/xen-project-4-4-features-and-futures" target="_blank" rel="external">Xen Project 4.4</a> slides by Russell Pavlicek, Mar 27, 2014, for a recent summary.</li>
<li>The AWS <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-types.html" target="_blank" rel="external">EC2 instance types</a> does explain that “HVM” isn’t fully “HVM”.</li>
<li>The AWS <a href="http://docs.aws.amazon.com/general/latest/gr/glos-chap.html#H" target="_blank" rel="external">glossary</a> also defines “HVM”.</li>
<li>Rackspace <a href="http://www.rackspace.com/knowledge_center/article/choosing-a-virtualization-mode-pv-versus-pvhvm" target="_blank" rel="external">choosing PV vs PVHVM</a>.</li>
<li>EC2 <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/enhanced-networking.html" target="_blank" rel="external">enhanced nerworking (SR-IOV)</a>.</li>
<li>The first hit from google for <a href="http://palakonda.org/2012/10/30/aws-virtualization-hvm-vs-paravirtualization/" target="_blank" rel="external">PV vs HVM</a> (out of date).</li>
<li>Moolah ecommerce <a href="http://moolah-ecommerce.com/blog/36-2014/219-amazon-vs-rackspace-performance" target="_blank" rel="external">benchmarked</a> the difference between PV and PVHVM, using <a href="http://www.brendangregg.com/blog/2014-05-02/compilers-love-messing-with-benchmarks.html" target="_blank" rel="external">UnixBench</a>?</li>
<li>Xen Orchestra has also benchmarked <a href="https://xen-orchestra.com/debian-pvhvm-vs-pv/" target="_blank" rel="external">Debian PVHVM vs PV</a> using … UnixBench? again?? (flips desk.)</li>
</ul>
<p>Thanks to the AWS performance engineers for helping me understand this better.</p>
<hr>
<p>转载请注明：原作者信息以及<a href="http://www.csyssec.org/about/" target="_blank" rel="external">CSysSec</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/虚拟化原理/">虚拟化原理<span class="article-category-count">7</span></a>


      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Virtualization/">Virtualization</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XEN/">XEN</a></li></ul>

      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-cloud-osv"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/20170504/cloud-osv/">Unikernels为云设计的库操作系统(OSv)</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/20170504/cloud-osv/" class="article-date">
	  <time datetime="2017-05-04T10:21:55.000Z" itemprop="datePublished">五月 4, 2017</time>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Author：<a href="https://github.com/bzhu5" target="_blank" rel="external">Bing Zhu</a><br>Source：<a href="http://hypervsir.blogspot.com/2014/11/unikernels-library-operating-systems.html" target="_blank" rel="external">http://hypervsir.blogspot.com/2014/11/unikernels-library-operating-systems.html</a><br>转载请注明：原作者信息以及<a href="http://www.csyssec.org/about/" target="_blank" rel="external">CSysSec</a></p>
<hr>
<p>Unlike a general-purpose, commercial operating system (like Windows, Ubuntu), OSv (<a href="http://osv.io/" target="_blank" rel="external">http://osv.io/</a> from cloudius-systems) is a single-purpose operating system. It is also kind of library operating system <strong><em>designed for the cloud</em></strong>  that running on top of different hypervisors, e.g. XEN, KVM, VMware. So what does OSv like look? </p>
<p>By quickly taking a look at this slide (<a href="http://www.slideshare.net/dmarti1111/o-sv-usenix-atc-2014" target="_blank" rel="external">http://www.slideshare.net/dmarti1111/o-sv-usenix-atc-2014</a>), we can get to know these two features below. </p>
<ul>
<li>General-purpose OS has kernel mode (ring 0) and user mode (ring 3), but <strong>OSv only has code running in Ring 0 mode, it doesn’t have code running in user (ring 3) mode</strong>. This is one of most significant differences.</li>
<li>The other main difference is that the <strong>OSv only has one single address space</strong> (multiple threads allowed, though) running on a hypervisor as being a single virtual appliance, which serves a single-purpose cloud service. </li>
</ul>
<p>So, each OSv holds one specific application (with multiple threads) on top of it, and the OSv itself runs as a guest OS on top of hypervisor. Application and resource isolation is guaranteed by the hypervisor.</p>
<p>Since an OSv has a single address space, it needs only one CR3 value. Process and address space switch (scheduler) is not required any more, and hence no TLB flush overhead introduced. This also can reduce “kernel” component memory footprint, and let application own more memory space.</p>
<p>Regarding address translation overheads, e.g. GVA-&gt;GPA-&gt;HPA, by using the larger table (2MB, or even 1GB) for both guest virtual memory page tables and EPT tables, such a translation overhead could be further reduced a lot. </p>
<p>Note that, as the slides pointed out, <strong>syscalls (user/kernel switch) are no longer required</strong>. Any traditional syscalls now are converted to just function calls in kernel mode only. Although this can significantly reduce performance cost, it also causes a new issue: application ABI compatibility issue. This means that in order to deploy this application on top of OSv, the source code must have to be modified and recompiled. </p>
<p>There are many challenges, you can check <a href="http://osv.io/" target="_blank" rel="external">http://osv.io/</a> for greater details. But anyway, if OSv is a correct direction for cloud OS (and with a success on having rich application supported) in future, it will definitely have a direct competition with some other solutions like <a href="https://www.docker.com/" target="_blank" rel="external">Docker</a>. </p>
<p>I like this product in person, the much simpler it is, the more I love it :-).</p>
<p>Also, see this slide (OSb: <a href="http://www.slideshare.net/yushiomote/osb-osv-on-bitvisor" target="_blank" rel="external">OSv on BitVisor</a>), someone is working on enabling OSv on top of <strong><a href="http://hypervsir.blogspot.com/2014/11/paper-read-bitvisor-thin-hypervisor-for.html" target="_blank" rel="external">BitVisor</a></strong>,  cool ! </p>
<hr>
<p><strong><em>Some other references about Library OS:</em></strong></p>
<p>Unikernels: Rise of the Virtual Library Operating System<br><a href="http://queue.acm.org/detail.cfm?id=2566628" target="_blank" rel="external">http://queue.acm.org/detail.cfm?id=2566628</a></p>
<p>XPDS14: OSv - A Modern Semi-POSIX LibraryOS - Glauber Costa<br><a href="http://www.xenproject.org/help/presentations-and-videos/video/xpds14v-osv.html" target="_blank" rel="external">http://www.xenproject.org/help/presentations-and-videos/video/xpds14v-osv.html</a></p>
<p>Rethinking the Library OS from the Top Down:<br><a href="http://research.microsoft.com/pubs/141071/asplos2011-drawbridge.pdf" target="_blank" rel="external">http://research.microsoft.com/pubs/141071/asplos2011-drawbridge.pdf</a></p>
<p>OSv on bhyve:<br><a href="http://bhyvecon.org/osv_on_bhyve.pdf" target="_blank" rel="external">http://bhyvecon.org/osv_on_bhyve.pdf</a></p>
<hr>
<p>转载请注明：原作者信息以及<a href="http://www.csyssec.org/about/" target="_blank" rel="external">CSysSec</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/系统内核/">系统内核<span class="article-category-count">11</span></a>


      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cloud/">Cloud</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kernel/">Kernel</a></li></ul>

      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/6/">下一页</a>
  </nav>

</section>
          <aside id="sidebar">
  
    <div class="widget-wrap" style="margin: 20px 0;">
	<div id="search-form-wrap">

    <form class="search-form">
        <label style="width: 75%;">
            <span class="screen-reader-text">Search for:</span>
            <input type="search" class="search-field" style="height: 42px;" placeholder=" 搜索…" value="" name="s" title="Search for:">
        </label>
        <input type="submit" class="search-form-submit" value="搜索">
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(无标题)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
</div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">集思广益</h3>
      <p>我们推崇的是黑客与分享精神，如果您觉得本站对您有帮助，不妨自己也参与进来共同建设，期待您能推荐好文章或投稿至本站，
让更多人受益。本站热烈欢迎志同道合者与志愿者参与本站的共同维护和建设，您可通过微博[@Diting0x](http://weibo.com/diting0x)联系我</p>
       <div class="widget widget_athemes_social_icons">

    	<ul class="clearfix widget-social-icons">   
    	
   			<li><a href="null" title="Words"><i class="fa fa-words" aria-hidden="true"></i></a></li> 

   		
   		</ul>


   		<!--
   		<ul class="clearfix widget-social-icons">   		
   		<li class="widget-si-twitter"><a href="http://twitter.com" title="Twitter"><i class="ico-twitter"></i></a> </li> 
		<li class="widget-si-facebook"><a href="http://facebook.com" title="Facebook"><i class="ico-facebook"></i></a></li>
			<li class="widget-si-gplus"><a href="http://plus.google.com" title="Google+"><i class="ico-gplus"></i></a></li>
			<li class="widget-si-pinterest"><a href="http://pinterest.com" title="Pinterest"><i class="ico-pinterest"></i></a></li>
			<li class="widget-si-flickr"><a href="http://flickr.com" title="Flickr"><i class="ico-flickr"></i></a></li>
			<li class="widget-si-instagram"><a href="http://instagram.com" title="Instagram"><i class="ico-instagram"></i></a></li>


        	</ul> -->

    </div>
  </div>


  
    
  <div class="widget_athemes_tabs">
    <ul id="widget-tab" class="clearfix widget-tab-nav">
      <li class="active"><a>最新推荐</a></li>
    </ul>
    <div class="widget">
      <ul>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170808/rowhammer/">神乎其神的Rowhammer：用比特位翻转实现云虚拟机夺权</a></h6>
          <!--  <span>八月 8, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170808/googleprojectzero/">谷歌Project Zero：通过“Row hammer”漏洞获取系统权限</a></h6>
          <!--  <span>八月 8, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170807/bypassaslr-analysis/">ASLR保护机制被突破的攻击技术分析</a></h6>
          <!--  <span>八月 7, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170605/memorysafety-defense/">内存持久战之防御措施</a></h6>
          <!--  <span>六月 5, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170531/ravel/">会找漏洞的时光机-Pinpointing Vulnerabilities</a></h6>
          <!--  <span>五月 31, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170513/memorysafety-attack/">内存支持战之攻击模型</a></h6>
          <!--  <span>五月 13, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170513/memorysafety/">内存持久战之内存安全性</a></h6>
          <!--  <span>五月 13, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170508/intro-aslr/">系统安全浅薄知识系列(一)-ASLR</a></h6>
          <!--  <span>五月 8, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170505/cfi-mathias/">控制流完整性-Mathias Payer</a></h6>
          <!--  <span>五月 5, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170505/vmi-xenproject/">虚拟机自省技术-一个有新商业应用的安全性创造</a></h6>
          <!--  <span>五月 5, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170504/cf-exception/">控制流分支指令上的控制流处理器异常(单步执行)</a></h6>
          <!--  <span>五月 4, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170504/cfi-development/">控制流完整性的发展历程</a></h6>
          <!--  <span>五月 4, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170504/cfi-ccs05/">控制流完整性-CCS05年论文</a></h6>
          <!--  <span>五月 4, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170504/rop-intel/">因特尔发布新的技术规范去防御 ROP 攻击</a></h6>
          <!--  <span>五月 4, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170504/ropjop-research/">ROP/JOP攻击与防御最新研究进展</a></h6>
          <!--  <span>五月 4, 2017</span> -->
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/20170504/nmi-virtual/">虚拟化技术的NMI窗口退出</a></h6>
          <!--  <span>五月 4, 2017</span> -->
            </div>

          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类导航</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Hypervisor安全/">Hypervisor安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/主流会议/">主流会议</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/二进制分析/">二进制分析</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/内存安全/">内存安全</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/内核安全/">内核安全</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/内核完整性/">内核完整性</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/博士之路/">博士之路</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/名人课堂/">名人课堂</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/学术专家/">学术专家</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全圈子/">安全圈子</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/恶意代码/">恶意代码</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞利用/">漏洞利用</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/硬件特性/">硬件特性</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/硬件虚拟化/">硬件虚拟化</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统内核/">系统内核</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统安全/">系统安全</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统安全科普/">系统安全科普</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/虚拟化原理/">虚拟化原理</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/虚拟化基础/">虚拟化基础</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/虚拟化综合/">虚拟化综合</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/虚拟机快照/">虚拟机快照</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/虚拟机监控/">虚拟机监控</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/虚拟机记录与重放/">虚拟机记录与重放</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/虚拟机迁移/">虚拟机迁移</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签导航</h3>
    <div class="widget tagcloud">
      <a href="/tags/ASLR/" style="font-size: 12.31px;">ASLR</a> <a href="/tags/ASPLOS/" style="font-size: 10px;">ASPLOS</a> <a href="/tags/Attack/" style="font-size: 12.31px;">Attack</a> <a href="/tags/Binary/" style="font-size: 10.77px;">Binary</a> <a href="/tags/CFI/" style="font-size: 12.31px;">CFI</a> <a href="/tags/Cloud/" style="font-size: 10px;">Cloud</a> <a href="/tags/Compiler/" style="font-size: 10px;">Compiler</a> <a href="/tags/Conference/" style="font-size: 12.31px;">Conference</a> <a href="/tags/Conferences/" style="font-size: 10px;">Conferences</a> <a href="/tags/Course/" style="font-size: 13.08px;">Course</a> <a href="/tags/Exception/" style="font-size: 10px;">Exception</a> <a href="/tags/Exploit/" style="font-size: 16.92px;">Exploit</a> <a href="/tags/Forensics/" style="font-size: 10px;">Forensics</a> <a href="/tags/HAV/" style="font-size: 12.31px;">HAV</a> <a href="/tags/Hardware/" style="font-size: 13.85px;">Hardware</a> <a href="/tags/Heap/" style="font-size: 10.77px;">Heap</a> <a href="/tags/Hooking/" style="font-size: 10px;">Hooking</a> <a href="/tags/Instrumentation/" style="font-size: 10.77px;">Instrumentation</a> <a href="/tags/Introspection/" style="font-size: 13.85px;">Introspection</a> <a href="/tags/JOP/" style="font-size: 10px;">JOP</a> <a href="/tags/KVM/" style="font-size: 16.15px;">KVM</a> <a href="/tags/Kernel/" style="font-size: 17.69px;">Kernel</a> <a href="/tags/Libvmi/" style="font-size: 13.08px;">Libvmi</a> <a href="/tags/Linux/" style="font-size: 13.08px;">Linux</a> <a href="/tags/Malware/" style="font-size: 15.38px;">Malware</a> <a href="/tags/Memory/" style="font-size: 13.08px;">Memory</a> <a href="/tags/Migration/" style="font-size: 11.54px;">Migration</a> <a href="/tags/Monitoring/" style="font-size: 13.08px;">Monitoring</a> <a href="/tags/NX/" style="font-size: 10px;">NX</a> <a href="/tags/Overflow/" style="font-size: 10.77px;">Overflow</a> <a href="/tags/PIN/" style="font-size: 10px;">PIN</a> <a href="/tags/Paper/" style="font-size: 11.54px;">Paper</a> <a href="/tags/Ph-D/" style="font-size: 10.77px;">Ph.D</a> <a href="/tags/Ppaerwriting/" style="font-size: 10px;">Ppaerwriting</a> <a href="/tags/Professor/" style="font-size: 12.31px;">Professor</a> <a href="/tags/QEMU/" style="font-size: 14.62px;">QEMU</a> <a href="/tags/RE/" style="font-size: 10px;">RE</a> <a href="/tags/ROP/" style="font-size: 10.77px;">ROP</a> <a href="/tags/Rootkit/" style="font-size: 11.54px;">Rootkit</a> <a href="/tags/Rowhammer/" style="font-size: 10.77px;">Rowhammer</a> <a href="/tags/SYSCALL/" style="font-size: 10px;">SYSCALL</a> <a href="/tags/Sandbox/" style="font-size: 10.77px;">Sandbox</a> <a href="/tags/Security/" style="font-size: 20px;">Security</a> <a href="/tags/Shellcode/" style="font-size: 10px;">Shellcode</a> <a href="/tags/Snapshot/" style="font-size: 10px;">Snapshot</a> <a href="/tags/Stack/" style="font-size: 10.77px;">Stack</a> <a href="/tags/Syscall/" style="font-size: 10px;">Syscall</a> <a href="/tags/System/" style="font-size: 18.46px;">System</a> <a href="/tags/Systemcall/" style="font-size: 11.54px;">Systemcall</a> <a href="/tags/TSX/" style="font-size: 10px;">TSX</a> <a href="/tags/TrustZone/" style="font-size: 10px;">TrustZone</a> <a href="/tags/VT-x/" style="font-size: 10px;">VT-x</a> <a href="/tags/Valgrind/" style="font-size: 10px;">Valgrind</a> <a href="/tags/Virtualization/" style="font-size: 19.23px;">Virtualization</a> <a href="/tags/Volatility/" style="font-size: 10px;">Volatility</a> <a href="/tags/XEN/" style="font-size: 13.08px;">XEN</a>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      版权所有&copy; 2017 Index of Computer System and Security 保留所有权利.
      </div>
      <div class="site-credit">
       <!--  自豪地使用 <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a> --> 
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
    <a href="/syssec" class="mobile-nav-link">Syssec</a>
  
    <a href="/architecture" class="mobile-nav-link">Architecture</a>
  
    <a href="/virtualization" class="mobile-nav-link">Virtualization</a>
  
    <a href="/malware" class="mobile-nav-link">Malware</a>
  
    <a href="/conferences" class="mobile-nav-link">Conferences</a>
  
    <a href="/courses" class="mobile-nav-link">Courses</a>
  
    <a href="/academy" class="mobile-nav-link">Academy</a>
  
    <a href="/news" class="mobile-nav-link">News</a>
  
    <a href="/knowledge" class="mobile-nav-link">Knowledge</a>
  
    <a href="/share" class="mobile-nav-link">Share</a>
  
    <a href="/contribution" class="mobile-nav-link">Contribution</a>
  
</nav> -->
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>





  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
  

  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1261078922&web_id=1261078922" language="JavaScript"></script>
  </div>


</body>
</html>
